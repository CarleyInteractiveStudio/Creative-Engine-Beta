<!DOCTYPE html>
<html lang="es" data-theme="dark-modern">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor | Creative Engine</title>
    <link rel="stylesheet" href="css/editor.css">
    <link rel="stylesheet" href="css/debug.css">
    <link rel="icon" href="image/Creative_Engine_beta.png" type="image/png">
</head>
<body>
    <!-- Loading Overlay Panel -->
    <div id="loading-overlay">
        <div class="loading-content">
            <img src="image/Creative_Engine_beta.png" alt="Creative Engine Logo" class="loading-logo">
            <h2 id="loading-status-message">Cargando tu proyecto...</h2>
            <div class="progress-bar-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>
            <div id="loading-error-section" style="display: none;">
                <p id="loading-error-message">Ha ocurrido un error.</p>
                <div class="error-buttons">
                    <button id="btn-retry-loading">Reintentar</button>
                    <button id="btn-back-to-launcher">Volver al Inicio</button>
                </div>
            </div>
        </div>
    </div>

    <div id="editor-container" style="display: none;">
        <div id="menubar">
            <div class="menubar-left">
                <div class="logo-area">
                    <img src="image/Creative_Engine_beta.png" alt="Logo">
                    <span id="project-name-display"></span>
                </div>
            </div>
            <div class="menubar-center">
                <div class="menu-item">
                    <button class="menu-btn">Archivo</button>
                    <div class="menu-content">
                        <a href="#" id="menu-import-project">Importar Proyecto...</a>
                        <a href="#" id="menu-export-project">Exportar Proyecto...</a>
                        <hr>
                        <a href="#" id="menu-import-asset">Importar Asset...</a>
                        <a href="#" id="menu-export-asset" class="disabled">Exportar Asset...</a>
                        <hr>
                        <a href="#" id="menu-build">Build</a>
                    </div>
                </div>
                <div class="menu-item">
                    <button class="menu-btn">Editar</button>
                    <div class="menu-content">
                        <a href="#" id="menu-project-settings">Configuraci√≥n del Proyecto</a>
                        <a href="#" id="menu-preferences">Preferencias</a>
                    </div>
                </div>
                <div class="menu-item">
                    <button class="menu-btn">Ventana</button>
                    <div class="menu-content" id="window-menu-content">
                        <a href="#" id="menu-window-scene">Escena</a>
                        <a href="#" id="menu-window-hierarchy">Jerarqu√≠a</a>
                        <a href="#" id="menu-window-inspector">Inspector</a>
                        <a href="#" id="menu-window-assets">Navegador</a>
                        <a href="#" id="menu-window-console">Consola</a>
                        <hr>
                        <a href="#" id="menu-window-animation">Editor de Animaci√≥n</a>
                        <a href="#" id="menu-window-animator">Controlador de Animaci√≥n</a>
                        <a href="#" id="menu-window-tile-palette">Editor de Paleta de Tiles</a>
                        <hr>
                        <a href="#" id="menu-window-asset-store">Tienda de asset</a>
                    </div>
                </div>
                <div class="menu-item">
                    <button id="menubar-carl-ia-btn" class="menu-btn">ü§ñ Carl IA</button>
                </div>
                <div class="menu-item">
                    <button class="menu-btn">Ayuda</button>
                    <div class="menu-content">
                        <a href="https://carleyinteractivestudio.github.io/Carley-Interactive-Studio/" target="_blank" id="menu-help">Ayuda</a>
                    </div>
                </div>
            </div>
            <div class="menubar-right">
                <button id="toolbar-music-btn" class="toolbar-btn" title="Reproductor de M√∫sica">üéµ</button>
            </div>
        </div>
        <main id="editor-main-content">
            <!-- The editor panels will go here in the next step -->
             <div id="hierarchy-panel" class="editor-panel">
                <div class="panel-header">
                    <span>Jerarqu√≠a</span>
                    <button class="close-panel-btn" data-panel="hierarchy-panel">&times;</button>
                </div>
                <div class="panel-content" id="hierarchy-content"></div>
             </div>
             <div id="scene-panel" class="editor-panel">
                <div class="panel-header">
                    <div class="left-header-controls">
                        <span id="current-scene-name">Escena Principal</span>
                        <div class="viewport-tools">
                            <div class="tool-dropdown">
                                <button id="tool-active" class="toolbar-btn">üñêÔ∏è</button>
                                <div class="tool-dropdown-content">
                                    <button id="tool-move" class="toolbar-btn active" title="Mover (Q)">üñêÔ∏è Mover</button>
                                    <button id="tool-rotate" class="toolbar-btn" title="Rotar (R)">üîÑ Rotar</button>
                                    <button id="tool-scale" class="toolbar-btn" title="Escalar (E)">‚ÜóÔ∏è Escalar</button>
                                    <button id="tool-pan" class="toolbar-btn" title="Panear (W)">‚ÜîÔ∏è Panear</button>
                                    <hr class="tilemap-tool-divider" style="display: none;">
                                    <button id="tool-tile-brush" class="toolbar-btn tilemap-tool" title="Pincel de Tiles (B)" style="display: none;">üñåÔ∏è Pincel</button>
                                    <button id="tool-tile-eraser" class="toolbar-btn tilemap-tool" title="Goma de Tiles (N)" style="display: none;">üßº Goma</button>
                                </div>
                            </div>
                        </div>
                        <div class="view-toggle">
                            <button class="view-toggle-btn active" data-view="scene-content">Escena</button>
                            <button class="view-toggle-btn" data-view="game-content">Juego</button>
                            <button class="view-toggle-btn" data-view="code-editor-content">C√≥digo</button>
                            <button id="view-toggle-terminal" class="view-toggle-btn" data-view="terminal-content" style="display: none;">Terminal</button>
                        </div>
                    </div>
                    <div id="game-controls" class="game-controls" style="display: none;">
                        <button id="btn-play" title="Play">‚ñ∂Ô∏è</button>
                        <button id="btn-pause" title="Pause" style="display: none;">‚è∏Ô∏è</button>
                        <button id="btn-stop" title="Stop" style="display: none;">‚èπÔ∏è</button>
                    </div>
                </div>
                <div class="panel-content-container">
                    <div id="scene-content" class="panel-content view-content active">
                        <canvas id="scene-canvas"></canvas>
                    </div>
                    <div id="game-content" class="panel-content view-content">
                        <canvas id="game-canvas"></canvas>
                    </div>
                    <div id="code-editor-content" class="panel-content view-content no-padding">
                        <div id="code-editor-toolbar">
                            <button id="code-save-btn" title="Guardar (Ctrl+S)">üíæ Guardar</button>
                            <button id="code-undo-btn" title="Deshacer (Ctrl+Z)">‚¨ÖÔ∏è</button>
                            <button id="code-redo-btn" title="Rehacer (Ctrl+Y)">‚û°Ô∏è</button>
                        </div>
                        <div id="codemirror-container"></div>
                    </div>
                    <div id="terminal-content" class="panel-content view-content no-padding">
                        <div id="terminal-output">
                            <span>Creative Engine Terminal [Versi√≥n 0.1.0]</span><br>
                            <span>(c) Carley Interactive Studio. Todos los derechos reservados.</span><br><br>
                        </div>
                        <div id="terminal-input-line">
                            <span class="terminal-prompt">&gt;</span>
                            <input type="text" id="terminal-input" autocomplete="off" spellcheck="false">
                        </div>
                    </div>
                </div>
            </div>
            <div class="resizer-v" id="resizer-left"></div>
            <div class="resizer-v" id="resizer-right"></div>
            <div class="resizer-h" id="resizer-bottom"></div>
             <div id="inspector-panel" class="editor-panel">
                <div class="panel-header">
                    <span>Inspector</span>
                    <button class="close-panel-btn" data-panel="inspector-panel">&times;</button>
                </div>
                <div class="panel-content"></div>
            </div>
             <div id="assets-panel" class="editor-panel">
                <div class="panel-header tab-bar">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="assets-content">Navegador</button>
                        <button class="tab-btn" data-tab="console-content">Consola</button>
                        <button class="tab-btn" data-tab="debug-content">Depurador</button>
                    </div>
                    <button class="close-panel-btn" data-panel="assets-panel">&times;</button>
                </div>
                <div class="panel-content-container">
                    <div id="assets-content" class="panel-content tab-content active no-padding">
                        <div id="asset-browser-container">
                            <div id="asset-folder-tree">
                                <!-- Folder tree will be populated by JS -->
                            </div>
                            <div id="asset-grid-view">
                                <!-- Asset icons will be populated by JS -->
                            </div>
                        </div>
                    </div>
                    <div id="console-content" class="panel-content tab-content">
                        <!-- Console messages will go here -->
                    </div>
                    <div id="debug-content" class="panel-content tab-content">
                        <!-- Debug info will be injected here by editor.js -->
                    </div>
                </div>
            </div>
             <div id="animation-panel" class="editor-panel floating-panel hidden">
                <div class="panel-header">
                    <span>Editor de Animaci√≥n</span>
                    <div class="panel-header-controls">
                        <button class="panel-tool-btn maximize-btn" title="Maximizar/Restaurar">üóñ</button>
                        <button class="close-panel-btn" data-panel="animation-panel">&times;</button>
                    </div>
                </div>
                <div class="panel-content">
                    <div id="animation-toolbar">
                        <button id="animation-save-btn" title="Guardar Asset">üíæ Guardar</button>
                        <select id="animation-state-selector"></select>
                        <button id="animation-play-btn">‚ñ∂Ô∏è</button>
                        <button id="animation-stop-btn">‚èπÔ∏è</button>
                        <label for="animation-speed">Velocidad:</label>
                        <input type="number" id="animation-speed" value="10" min="1">
                        <span>FPS</span>
                        <button id="add-frame-btn">‚ûï A√±adir Frame</button>
                        <button id="delete-frame-btn" title="Borrar Frame Seleccionado">üóëÔ∏è</button>
                        <button id="timeline-toggle-btn" title="Ocultar/Mostrar L√≠nea de Tiempo">‚ñ≤</button>
                    </div>
                    <div id="animation-content-container">
                        <div id="animation-edit-view">
                            <div id="animation-timeline-container">
                                <div id="animation-timeline">
                                    <!-- Frames will be added here -->
                                </div>
                            </div>
                            <div id="timeline-resizer"></div>
                            <div id="animation-editor-main">
                                <div id="drawing-tools">
                                    <button class="tool-btn active" data-tool="pencil" title="L√°piz">‚úèÔ∏è</button>
                                    <button class="tool-btn" data-tool="eraser" title="Goma de Borrar">üßº</button>
                                    <input type="color" id="drawing-color-picker" value="#ffffff" title="Selector de Color">
                                    <hr>
                                    <button class="tool-btn active" data-draw-mode="free" title="Dibujo Libre">‚úçÔ∏è</button>
                                    <button class="tool-btn" data-draw-mode="pixel" title="Modo P√≠xel">‚ñ¶</button>
                                </div>
                                <div id="animation-view-tools">
                                    <button id="anim-bg-toggle-btn" class="tool-btn" title="Cambiar Fondo (Blanco/Transparente)">‚¨õ</button>
                                    <button id="anim-grid-toggle-btn" class="tool-btn active" title="Mostrar/Ocultar Rejilla">ƒ±zgara</button>
                                    <button id="anim-onion-toggle-btn" class="tool-btn active" title="Activar/Desactivar Onion Skin">üßÖ</button>
                                </div>
                                <div id="drawing-canvas-container">
                                    <canvas id="anim-grid-canvas" width="512" height="512"></canvas>
                                    <canvas id="anim-onion-skin-canvas" width="512" height="512"></canvas>
                                    <canvas id="drawing-canvas" width="512" height="512"></canvas>
                                </div>
                            </div>
                        </div>
                        <div id="animation-playback-view" class="hidden">
                            <canvas id="animation-playback-canvas" width="512" height="512"></canvas>
                        </div>
                    </div>
                    <div id="animation-panel-overlay">
                        <p>Selecciona un asset de animaci√≥n (.cea) para empezar.</p>
                    </div>
                <div class="resize-handle" data-direction="n"></div>
                <div class="resize-handle" data-direction="ne"></div>
                <div class="resize-handle" data-direction="e"></div>
                <div class="resize-handle" data-direction="se"></div>
                <div class="resize-handle" data-direction="s"></div>
                <div class="resize-handle" data-direction="sw"></div>
                <div class="resize-handle" data-direction="w"></div>
                <div class="resize-handle" data-direction="nw"></div>
                </div>
            </div>
            <div id="animator-controller-panel" class="editor-panel floating-panel hidden">
                <div class="panel-header">
                    <span>Controlador de Animaci√≥n</span>
                    <div id="animator-controller-toolbar">
                        <button id="anim-ctrl-new-btn">Nuevo</button>
                        <button id="anim-ctrl-save-btn">Guardar</button>
                        <span id="current-anim-ctrl-name">Ninguno</span>
                    </div>
                    <button class="close-panel-btn" data-panel="animator-controller-panel">&times;</button>
                </div>
                <div class="panel-content no-padding">
                    <div id="animator-assets-list">
                        <div class="list-header">Animaciones (.cea)</div>
                        <input type="search" placeholder="Buscar animaciones...">
                        <div class="list-content"></div>
                    </div>
                    <div id="animator-graph-view">
                        <!-- The visual state machine graph will be rendered here -->
                    </div>
                    <div id="animator-controllers-list">
                        <div class="list-header">Controladores (.ceanim)</div>
                        <input type="search" placeholder="Buscar controladores...">
                        <div class="list-content"></div>
                    </div>
                </div>
                <div class="resize-handle" data-direction="right"></div>
                <div class="resize-handle" data-direction="bottom"></div>
                <div class="resize-handle" data-direction="both"></div>
            </div>
            <div id="ui-editor-panel" class="editor-panel floating-panel hidden">
                <div class="panel-header">
                    <span id="current-ui-asset-name">Editor de UI</span>
                    <div id="ui-canvas-toolbar">
                        <button id="ui-editor-save-btn" title="Guardar Asset UI">üíæ Guardar</button>
                        <button id="ui-canvas-maximize-btn" title="Maximizar Canvas">üóñ</button>
                    </div>
                    <button class="close-panel-btn" data-panel="ui-editor-panel">&times;</button>
                </div>
                <div id="ui-editor-main-content">
                    <div id="ui-editor-hierarchy" class="editor-panel">
                        <div class="panel-header"><span>Jerarqu√≠a UI</span></div>
                        <div class="list-content"></div>
                    </div>
                    <div id="ui-resizer-left" class="resizer-v"></div>
                    <div id="ui-editor-canvas-view">
                         <div id="ui-editor-canvas-container">
                            <canvas id="ui-editor-canvas"></canvas>
                        </div>
                    </div>
                    <div id="ui-resizer-right" class="resizer-v"></div>
                    <div id="ui-editor-inspector" class="editor-panel">
                        <div class="panel-header"><span>Inspector UI</span></div>
                        <div class="inspector-content"></div>
                    </div>
                </div>
                <div class="resize-handle" data-direction="n"></div>
                <div class="resize-handle" data-direction="ne"></div>
                <div class="resize-handle" data-direction="e"></div>
                <div class="resize-handle" data-direction="se"></div>
                <div class="resize-handle" data-direction="s"></div>
                <div class="resize-handle" data-direction="sw"></div>
                <div class="resize-handle" data-direction="w"></div>
                <div class="resize-handle" data-direction="nw"></div>
            </div>
            <div id="asset-store-panel" class="editor-panel floating-panel hidden" style="width: 800px; height: 600px;">
                <div class="panel-header">
                    <span>Tienda de Asset</span>
                    <div class="panel-header-controls">
                        <button id="btn-open-asset-store-ext" class="panel-tool-btn" title="Abrir en nueva pesta√±a">‚ÜóÔ∏è</button>
                        <button class="close-panel-btn" data-panel="asset-store-panel">&times;</button>
                    </div>
                </div>
                <div class="panel-content no-padding">
                    <iframe src="https://carleyinteractivestudio.github.io/Creative-Engine-Asset-Store/" style="width: 100%; height: 100%; border: none;"></iframe>
                </div>
                <div class="resize-handle" data-direction="n"></div>
                <div class="resize-handle" data-direction="ne"></div>
                <div class="resize-handle" data-direction="e"></div>
                <div class="resize-handle" data-direction="se"></div>
                <div class="resize-handle" data-direction="s"></div>
                <div class="resize-handle" data-direction="sw"></div>
                <div class="resize-handle" data-direction="w"></div>
                <div class="resize-handle" data-direction="nw"></div>
            </div>
            <div id="carl-ia-panel" class="editor-panel floating-panel hidden" style="width: 400px; height: 500px;">
                <div class="panel-header">
                    <span>ü§ñ Carl IA</span>
                    <div class="panel-header-controls">
                        <div class="menu-item">
                            <button id="carl-ia-brain-selector-btn" class="panel-tool-btn">Elegir Cerebro</button>
                            <div class="menu-content">
                                <a href="#" data-model="carl-v1">Carl V1</a>
                                <a href="#" data-model="external">Usar modelo externo</a>
                            </div>
                        </div>
                        <button class="close-panel-btn" data-panel="carl-ia-panel">&times;</button>
                    </div>
                </div>
                <div class="panel-content no-padding" style="display: flex; flex-direction: column;">
                    <div id="carl-ia-messages" style="flex-grow: 1; overflow-y: auto; padding: 10px; background: var(--color-background-deep); border-bottom: 1px solid var(--color-border); display: flex; flex-direction: column;">
                        <!-- Chat messages will appear here -->
                         <div style="font-style: italic; color: var(--color-text-secondary); text-align: center; padding: 20px;">
                            Selecciona un modelo para comenzar.
                         </div>
                    </div>
                    <div id="carl-ia-input-area" style="display: flex; padding: 8px; border-top: 1px solid var(--color-border-dark);">
                        <textarea id="carl-ia-input" placeholder="Escribe tu mensaje..." style="flex-grow: 1; resize: none; height: 40px; border-radius: 5px; border: 1px solid var(--color-border); background: var(--color-background-light); color: var(--color-text-primary); padding: 5px;"></textarea>
                        <button id="carl-ia-send-btn" style="margin-left: 8px; font-size: 20px; background: none; border: none; color: var(--color-accent); cursor: pointer;">‚û§</button>
                    </div>
                </div>
                <div class="resize-handle" data-direction="n"></div>
                <div class="resize-handle" data-direction="ne"></div>
                <div class="resize-handle" data-direction="e"></div>
                <div class="resize-handle" data-direction="se"></div>
                <div class="resize-handle" data-direction="s"></div>
                <div class="resize-handle" data-direction="sw"></div>
                <div class="resize-handle" data-direction="w"></div>
                <div class="resize-handle" data-direction="nw"></div>
            </div>
        </main>
    </div>
    <div id="context-menu" class="context-menu" style="display: none;">
        <ul>
            <li class="has-submenu">
                Crear <span class="arrow">‚ñ∂</span>
                <ul class="submenu">
                    <li data-action="create-folder">Carpeta</li>
                    <li data-action="create-script">Script (.ces)</li>
                    <li data-action="create-readme">Archivo L√©ame (.md)</li>
                    <li data-action="create-animation">Asset de Animaci√≥n (.cea)</li>
                    <li data-action="create-tile-palette">Paleta de Tiles (.cepalette)</li>
                    <li data-action="create-scene">Escena (.ceScene)</li>
                    <li data-action="create-package">Paquete (.cep)</li>
                </ul>
            </li>
            <hr>
            <li data-action="rename">Renombrar</li>
            <li data-action="delete" class="danger">Borrar</li>
            <hr class="folder-only-divider" style="display: none;">
            <li data-action="export-package" class="folder-only" style="display: none;">Exportar Paquete (.cep)</li>
        </ul>
    </div>
    <div id="anim-node-context-menu" class="context-menu" style="display: none;">
        <ul>
            <li data-action="create-transition">Crear Transici√≥n</li>
            <li data-action="set-as-entry">Marcar como Estado de Entrada</li>
            <hr>
            <li data-action="delete-state" class="danger">Borrar Estado</li>
        </ul>
    </div>
    <div id="hierarchy-context-menu" class="context-menu" style="display: none;">
        <ul>
            <li data-action="create-empty">Crear Vac√≠o</li>
            <li class="has-submenu">
                Objeto 2D <span class="arrow">‚ñ∂</span>
                <ul class="submenu">
                    <li data-action="create-camera">C√°mara</li>
                    <li data-action="create-tilemap">Tilemap</li>
                </ul>
            </li>
            <li class="has-submenu">
                Luz <span class="arrow">‚ñ∂</span>
                <ul class="submenu">
                    <li data-action="create-point-light">Point Light</li>
                    <li data-action="create-spot-light">Spot Light</li>
                    <li data-action="create-freeform-light">Freeform Light</li>
                    <li data-action="create-sprite-light">Sprite Light</li>
                </ul>
            </li>
            <hr>
            <li data-action="rename">Renombrar</li>
            <li data-action="duplicate">Duplicar</li>
            <li data-action="delete" class="danger">Eliminar</li>
        </ul>
    </div>
    <div id="sprite-selector-modal" class="modal">
        <div class="modal-content large">
            <span class="close-button">&times;</span>
            <h2>Seleccionar Sprite</h2>
            <div id="sprite-selector-grid"></div>
        </div>
    </div>
    <div id="add-component-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>A√±adir Ley (Componente)</h2>
            <div id="component-list"></div>
        </div>
    </div>
    <div id="culling-mask-dropdown" class="context-menu" style="display: none;">
        <!-- Layer checkboxes will be populated by JS -->
    </div>
    <div id="project-settings-modal" class="modal">
        <div class="modal-content large">
            <span class="close-button">&times;</span>
            <h2>Configuraci√≥n del Proyecto</h2>
            <div class="settings-form">
                <fieldset class="settings-section">
                    <legend>General</legend>
                    <label for="settings-app-name">Nombre del Proyecto</label>
                    <input type="text" id="settings-app-name" placeholder="Mi Juego Incre√≠ble">
                    <label for="settings-author-name">Nombre del Autor</label>
                    <input type="text" id="settings-author-name" placeholder="Un Creador de Mundos">
                    <label for="settings-app-version">Versi√≥n del Juego</label>
                    <input type="text" id="settings-app-version" placeholder="1.0.0">
                    <label>Versi√≥n del Motor</label>
                    <input type="text" id="settings-engine-version" value="0.1.0-beta" readonly>
                </fieldset>

                <fieldset class="settings-section">
                    <legend>Visual</legend>
                    <label>Icono del Ejecutable</label>
                    <div class="image-picker">
                        <img id="settings-icon-preview" src="image/Paquete.png" alt="Vista previa del icono" style="display:none;">
                        <button id="settings-icon-picker-btn">Seleccionar Icono...</button>
                    </div>
                    <p class="field-description">Selecciona una imagen (.png o .ico) para el ejecutable de tu juego.</p>
                    <hr>
                    <label>Logos de Inicio (Splash Screen)</label>
                    <div class="logo-list" id="settings-logo-list">
                        <!-- Logos a√±adidos por el usuario ir√°n aqu√≠ -->
                    </div>
                    <button id="settings-add-logo-btn">A√±adir Logo</button>
                    <div class="checkbox-field">
                        <input type="checkbox" id="settings-show-engine-logo" checked>
                        <label for="settings-show-engine-logo">Mostrar logo de Creative Engine</label>
                    </div>
                </fieldset>

                <fieldset class="settings-section">
                    <legend>Layers</legend>
                    <div class="layer-manager">
                        <div class="layer-column">
                            <h4>Sorting Layers</h4>
                            <p class="field-description">Controlan el orden de dibujado. El de arriba se dibuja primero.</p>
                            <div id="settings-sorting-layer-list" class="layer-list"></div>
                            <div class="layer-add-row">
                                <input type="text" id="new-sorting-layer-name" placeholder="Nuevo layer...">
                                <button id="add-sorting-layer-btn">A√±adir</button>
                            </div>
                        </div>
                        <div class="layer-column">
                            <h4>Collision Layers</h4>
                            <p class="field-description">Usados por el motor de f√≠sicas para filtrar colisiones.</p>
                            <div id="settings-collision-layer-list" class="layer-list"></div>
                             <div class="layer-add-row">
                                <input type="text" id="new-collision-layer-name" placeholder="Nuevo layer...">
                                <button id="add-collision-layer-btn">A√±adir</button>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset class="settings-section">
                    <legend>Tags & Layers</legend>
                    <div class="layer-manager">
                        <div class="layer-column">
                            <h4>Tags</h4>
                            <div id="settings-tag-list" class="layer-list"></div>
                            <div class="layer-add-row">
                                <input type="text" id="new-tag-name" placeholder="Nuevo tag...">
                                <button id="add-tag-btn">A√±adir Tag</button>
                            </div>
                        </div>
                        <div class="layer-column">
                            <h4>Layers</h4>
                            <p class="field-description">Define los nombres para las 32 capas disponibles.</p>
                            <div id="settings-layer-list" class="layer-list"></div>
                        </div>
                    </div>
                </fieldset>
                <fieldset class="settings-section">
                    <legend>Build</legend>
                    <h4>Firma de Android (Keystore)</h4>
                    <p class="field-description">Configuraci√≥n para firmar builds de Android.</p>
                    <label for="settings-keystore-path">Ruta al Keystore</label>
                    <div class="file-picker">
                        <input type="text" id="settings-keystore-path" readonly placeholder="Ninguno seleccionado">
                        <button id="settings-keystore-picker-btn">...</button>
                    </div>
                    <label for="settings-keystore-pass">Contrase√±a del Keystore</label>
                    <input type="password" id="settings-keystore-pass">
                    <label for="settings-key-alias">Alias de la Clave</label>
                    <input type="text" id="settings-key-alias">
                    <label for="settings-key-pass">Contrase√±a de la Clave</label>
                    <input type="password" id="settings-key-pass">
                    <button id="keystore-create-btn">Crear Nuevo Keystore...</button>
                    <hr>
                    <h4>Acciones de Exportaci√≥n</h4>
                    <button id="settings-export-project-btn">Exportar Assets (.cep)</button>
                </fieldset>
            </div>
            <div class="modal-footer">
                <button id="settings-save-btn" class="primary-btn">Guardar Cambios</button>
            </div>
        </div>
    </div>
    <div id="keystore-create-modal" class="modal">
        <div class="modal-content large">
            <span class="close-button">&times;</span>
            <h2>Crear Nuevo Keystore</h2>
            <div class="settings-form">
                <fieldset class="settings-section">
                    <legend>Informaci√≥n de la Clave</legend>
                    <label for="ks-alias">Alias</label>
                    <input type="text" id="ks-alias" placeholder="my-key-alias">
                    <label for="ks-password">Contrase√±a de la Clave (m√≠nimo 6 caracteres)</label>
                    <input type="password" id="ks-password">
                    <label for="ks-validity">Validez (a√±os)</label>
                    <input type="number" id="ks-validity" value="30">
                </fieldset>
                <fieldset class="settings-section">
                    <legend>Informaci√≥n del Certificado (Due√±o)</legend>
                    <label for="ks-cn">Nombre y Apellido</label>
                    <input type="text" id="ks-cn" placeholder="Juan P√©rez">
                    <label for="ks-ou">Unidad Organizativa</label>
                    <input type="text" id="ks-ou" placeholder="Desarrollo de Juegos">
                    <label for="ks-o">Organizaci√≥n</label>
                    <input type="text" id="ks-o" placeholder="Mi Estudio">
                    <label for="ks-l">Ciudad o Localidad</label>
                    <input type="text" id="ks-l" placeholder="Madrid">
                    <label for="ks-st">Estado o Provincia</label>
                    <input type="text" id="ks-st" placeholder="Madrid">
                    <label for="ks-c">C√≥digo de Pa√≠s (2 letras)</label>
                    <input type="text" id="ks-c" placeholder="ES" maxlength="2">
                </fieldset>
                <fieldset class="settings-section">
                    <legend>Archivo de Salida</legend>
                    <label for="ks-filename">Nombre del Archivo Keystore</label>
                    <input type="text" id="ks-filename" value="my-release-key.keystore">
                    <label for="ks-storepass">Contrase√±a del Archivo Keystore</label>
                    <input type="password" id="ks-storepass">
                </fieldset>
                <div id="ks-command-output" class="hidden">
                    <h4>Comando `keytool` Generado:</h4>
                    <textarea id="ks-command-textarea" readonly rows="5"></textarea>
                    <p class="field-description">Copia y ejecuta este comando en una terminal con JDK instalado si la creaci√≥n autom√°tica falla.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="ks-generate-btn" class="primary-btn">Generar</button>
            </div>
        </div>
    </div>
    <div id="engine-logo-confirm-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>¬øDesactivar el logo?</h2>
            <p>Respetamos tu decisi√≥n, y puedes desactivar esta opci√≥n en cualquier momento.</p>
            <p>Sin embargo, nos alegrar√≠a mucho que la mantuvieras activa: ayuda a que m√°s personas descubran Creative Engine, fortalece nuestra comunidad y acelera su crecimiento.</p>
            <p><strong>¬øEst√°s seguro de que deseas desactivarla?</strong></p>
            <div class="modal-footer">
                <button id="confirm-disable-logo-btn" class="danger-btn">S√≠, desactivar</button>
                <button id="cancel-disable-logo-btn" class="primary-btn">Cancelar</button>
            </div>
        </div>
    </div>
    <div id="preferences-modal" class="modal">
        <div class="modal-content large">
            <span class="close-button">&times;</span>
            <h2>Preferencias del Editor</h2>
            <div class="settings-form">
                <fieldset class="settings-section">
                    <legend>Apariencia</legend>
                    <label for="prefs-theme">Tema del Editor</label>
                    <select id="prefs-theme">
                        <option value="dark-modern">Oscuro Moderno</option>
                        <option value="dark-white">Claro</option>
                        <option value="dark-blue">Azul Marino</option>
                        <option value="custom">Personalizado</option>
                    </select>
                    <div id="prefs-custom-theme-picker" class="hidden">
                        <h4>Colores Personalizados</h4>
                        <div class="color-picker-group">
                            <label for="prefs-color-bg">Fondo Paneles</label>
                            <input type="color" id="prefs-color-bg" value="#2d2d30">
                        </div>
                        <div class="color-picker-group">
                            <label for="prefs-color-header">Fondo Cabeceras</label>
                            <input type="color" id="prefs-color-header" value="#3f3f46">
                        </div>
                        <div class="color-picker-group">
                            <label for="prefs-color-accent">Botones y Acentos</label>
                            <input type="color" id="prefs-color-accent" value="#0e639c">
                        </div>
                    </div>
                </fieldset>
                <fieldset class="settings-section">
                    <legend>Editor de C√≥digo</legend>
                    <label for="prefs-script-lang">Lenguaje de Scripting Preferido</label>
                    <select id="prefs-script-lang">
                        <option value="ces">Creative Engine Script (.ces)</option>
                        <option value="js">JavaScript (.js)</option>
                    </select>
                    <hr>
                    <div class="checkbox-field">
                        <input type="checkbox" id="prefs-autosave-toggle">
                        <label for="prefs-autosave-toggle">Guardado autom√°tico de scripts</label>
                    </div>
                    <div id="prefs-autosave-interval-group" class="hidden">
                        <label for="prefs-autosave-interval">Intervalo de guardado (segundos)</label>
                        <input type="number" id="prefs-autosave-interval" min="5" value="30">
                    </div>
                </fieldset>
                <fieldset class="settings-section">
                    <legend>Editor de Escena</legend>
                    <div class="checkbox-field">
                        <input type="checkbox" id="prefs-snapping-toggle">
                        <label for="prefs-snapping-toggle">Activar "Snapping" a la rejilla</label>
                    </div>
                    <div id="prefs-snapping-grid-size-group" class="hidden">
                        <label for="prefs-snapping-grid-size">Tama√±o de la rejilla (p√≠xeles)</label>
                        <input type="number" id="prefs-snapping-grid-size" min="1" value="25">
                    </div>
                    <hr>
                    <label for="prefs-zoom-speed">Velocidad del Zoom</label>
                    <input type="number" id="prefs-zoom-speed" min="1" max="10" step="0.1" value="1.1">
                    <p class="field-description">Controla la sensibilidad del zoom en la escena. Un valor m√°s alto significa un zoom m√°s r√°pido.</p>
                </fieldset>
                <fieldset class="settings-section">
                    <legend>Integraciones de IA</legend>
                    <label for="prefs-ai-provider">Proveedor de IA Externo</label>
                    <select id="prefs-ai-provider">
                        <option value="none">Ninguno</option>
                        <option value="gemini">Gemini</option>
                        <option value="openai">ChatGPT (OpenAI)</option>
                        <option value="anthropic">Claude (Anthropic)</option>
                    </select>
                    <div id="prefs-ai-api-key-group" class="hidden" style="margin-top: 10px;">
                        <label for="prefs-ai-api-key">API Key</label>
                        <input type="password" id="prefs-ai-api-key" placeholder="Introduce tu clave de API">
                        <div class="api-key-buttons" style="margin-top: 5px;">
                             <button id="prefs-ai-save-key-btn">Guardar Clave</button>
                             <button id="prefs-ai-delete-key-btn" style="display: none;">Borrar Clave</button>
                        </div>
                        <p class="field-description">Tu clave de API se guarda de forma segura en el almacenamiento local de tu navegador y nunca se env√≠a a nuestros servidores. Se utiliza √∫nicamente para la comunicaci√≥n directa entre tu navegador y el proveedor de IA que elijas.</p>
                    </div>
                </fieldset>
                <fieldset class="settings-section">
                    <legend>Ventanas</legend>
                    <div class="checkbox-field">
                        <input type="checkbox" id="prefs-show-terminal">
                        <label for="prefs-show-terminal">Ver terminal en el editor</label>
                    </div>
                     <p class="field-description">Muestra una pesta√±a de terminal junto a la vista de c√≥digo.</p>
                    <hr>
                    <button id="prefs-reset-layout-btn">Restablecer Dise√±o de Paneles</button>
                    <p class="field-description">Vuelve a la disposici√≥n de paneles por defecto.</p>
                </fieldset>
            </div>
            <div class="modal-footer">
                <button id="prefs-save-btn" class="primary-btn">Guardar Preferencias</button>
            </div>
        </div>
    </div>
    <div id="debug-display"></div>

    <div id="export-description-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Descripci√≥n del Paquete</h2>
            <div class="settings-form">
                <label for="export-description-text">A√±ade una breve descripci√≥n para tu paquete .cep:</label>
                <textarea id="export-description-text" rows="4" placeholder="Ej: Contiene el personaje principal y sus animaciones."></textarea>
            </div>
            <div class="modal-footer">
                <button id="export-description-next-btn" class="primary-btn">Siguiente</button>
            </div>
        </div>
    </div>

    <div id="package-file-tree-modal" class="modal">
        <div class="modal-content large">
            <span class="close-button">&times;</span>
            <h2 id="package-modal-title">Seleccionar Archivos</h2>
            <div id="package-modal-description">
                <!-- La descripci√≥n del paquete ir√° aqu√≠ -->
            </div>
            <div id="package-file-tree-container">
                <!-- El √°rbol de archivos se renderizar√° aqu√≠ -->
            </div>
            <div id="package-export-controls" class="modal-footer">
                <label for="export-filename">Nombre del Paquete:</label>
                <input type="text" id="export-filename" placeholder="MiPaquete.cep">
                <button id="export-confirm-btn" class="primary-btn">Exportar</button>
            </div>
            <div id="package-import-controls" class="modal-footer" style="display: none;">
                <button id="import-confirm-btn" class="primary-btn">Importar Seleccionados</button>
            </div>
        </div>
    </div>

    <div id="music-player-panel" class="editor-panel floating-panel hidden">
        <div class="panel-header">
            <span>Reproductor de M√∫sica</span>
            <button class="close-panel-btn" data-panel="music-player-panel">&times;</button>
        </div>
        <div class="panel-content no-padding">
            <div id="now-playing-bar">
                <span id="now-playing-title">Nada en reproducci√≥n</span>
            </div>
            <div id="playlist-container">
                <!-- La lista de canciones ir√° aqu√≠ -->
            </div>
            <div id="music-controls">
                <button id="music-add-btn">A√±adir</button>
                <button id="music-prev-btn">‚èÆÔ∏è</button>
                <button id="music-play-pause-btn">‚ñ∂Ô∏è</button>
                <button id="music-next-btn">‚è≠Ô∏è</button>
                <input type="range" id="music-volume-slider" min="0" max="1" step="0.01" value="0.5">
            </div>
        </div>
        <div class="resize-handle" data-direction="n"></div>
        <div class="resize-handle" data-direction="ne"></div>
        <div class="resize-handle" data-direction="e"></div>
        <div class="resize-handle" data-direction="se"></div>
        <div class="resize-handle" data-direction="s"></div>
        <div class="resize-handle" data-direction="sw"></div>
        <div class="resize-handle" data-direction="w"></div>
        <div class="resize-handle" data-direction="nw"></div>
    </div>

    <div id="tile-palette-panel" class="editor-panel floating-panel hidden">
        <div class="panel-header">
            <span id="palette-asset-name">Editor de Paleta de Tiles</span>
            <div class="panel-header-controls">
                 <button id="palette-save-btn" title="Guardar Paleta">üíæ Guardar</button>
                 <button class="close-panel-btn" data-panel="tile-palette-panel">&times;</button>
            </div>
        </div>
        <div class="panel-content no-padding">
            <div id="palette-toolbar">
                <div class="toolbar-group">
                    <label>Tileset:</label>
                    <button id="palette-select-image-btn">Seleccionar Imagen...</button>
                    <span id="palette-image-name">Ninguna</span>
                </div>
                <div class="toolbar-group">
                    <label for="palette-tile-width">Ancho Tile:</label>
                    <input type="number" id="palette-tile-width" value="32" min="1">
                    <label for="palette-tile-height">Alto Tile:</label>
                    <input type="number" id="palette-tile-height" value="32" min="1">
                </div>
                 <div class="toolbar-group">
                    <label>Tile Seleccionado:</label>
                    <span id="palette-selected-tile-id">-</span>
                </div>
            </div>
            <div id="palette-view-container">
                <canvas id="palette-grid-canvas"></canvas>
                <img id="palette-tileset-image" src="" alt="Tileset">
            </div>
        </div>
        <div id="palette-panel-overlay">
            <p>Abre un asset de paleta (.cepalette) o crea uno nuevo para empezar.</p>
        </div>
        <div class="resize-handle" data-direction="n"></div>
        <div class="resize-handle" data-direction="ne"></div>
        <div class="resize-handle" data-direction="e"></div>
        <div class="resize-handle" data-direction="se"></div>
        <div class="resize-handle" data-direction="s"></div>
        <div class="resize-handle" data-direction="sw"></div>
        <div class="resize-handle" data-direction="w"></div>
        <div class="resize-handle" data-direction="nw"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="module" src="js/editor.js?v=1.0"></script>
</body>
</html>
